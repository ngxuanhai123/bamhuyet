<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·ªï Tay B·∫•m Huy·ªát - Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #009688; /* Teal */
            --primary-dark: #00796b;
            --primary-light: #b2dfdb;
            --accent: #ff6f00; /* Amber for highlights */
            --bg: #f8f9fa;
            --surface: #ffffff;
            --text: #263238;
            --text-secondary: #546e7a;
            --success: #4caf50;
            --error: #f44336;
            --radius: 16px;
            --shadow: 0 10px 30px -10px rgba(0, 150, 136, 0.15);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Components --- */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(0, 150, 136, 0.3); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: #eceff1; color: var(--text); }
        .btn-danger { background: #ffebee; color: var(--error); }
        .btn-google { background: white; color: #333; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 100%; justify-content: center; }

        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.02);
            transition: transform 0.2s;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #eceff1;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus { border-color: var(--primary); }

        /* --- Layout --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary), #80cbc4);
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 24px;
            text-align: center; width: 90%; max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        #app-screen { display: none; flex: 1; flex-direction: column; }

        header {
            background: var(--surface);
            padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 10;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .brand { font-weight: 700; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-light); }

        .container {
            max-width: 900px; margin: 0 auto; width: 100%; padding: 20px;
            flex: 1;
        }

        /* --- Tabs --- */
        .nav-pills {
            display: flex; gap: 10px; margin-bottom: 25px;
            overflow-x: auto; padding-bottom: 5px;
        }
        .nav-item {
            padding: 10px 20px;
            border-radius: 50px;
            background: white;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        .nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 150, 136, 0.2);
        }

        /* --- Views --- */
        .view { display: none; animation: slideUp 0.4s ease; }
        .view.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Features --- */
        /* Streak / Calendar */
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 20px; border-radius: var(--radius); text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }

        .calendar-wrapper { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .cal-day {
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            background: #f1f3f4; border-radius: 8px; font-size: 0.85rem; font-weight: 500; position: relative;
        }
        .cal-day.checked { background: var(--success); color: white; }
        .cal-day.today { border: 2px solid var(--accent); }

        /* Quiz */
        .quiz-container { text-align: center; padding: 20px 0; }
        .quiz-badge { display: inline-block; padding: 6px 12px; background: #e0f2f1; color: var(--primary-dark); border-radius: 20px; font-size: 0.85rem; font-weight: 600; margin-bottom: 15px; }
        .quiz-question { font-size: 1.5rem; color: var(--primary); margin: 10px 0; font-weight: 700; }
        .quiz-desc { color: var(--text-secondary); font-style: italic; margin-bottom: 25px; line-height: 1.6; }
        
        .feedback { min-height: 40px; margin-top: 15px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .feedback.correct { color: var(--success); }
        .feedback.wrong { color: var(--error); }

        /* List */
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid #eee; transition: background 0.2s;
        }
        .list-item:last-child { border-bottom: none; }
        .list-item:hover { background: #fafafa; }
        .item-tag { font-size: 0.75rem; background: #e0f2f1; color: var(--primary-dark); padding: 4px 8px; border-radius: 6px; margin-left: 8px; }

        /* Toast Notification */
        #toast {
            visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 1000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 17px; opacity: 0; transition: opacity 0.3s, bottom 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

        /* Loading */
        #loading { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 200; display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 15px; display: none;}
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loading"><div class="spinner"></div><div style="color:var(--primary); font-weight:600">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</div></div>
    <div id="toast">Th√¥ng b√°o</div>

    <div id="login-screen">
        <div class="login-box">
            <div style="font-size: 3rem; margin-bottom: 10px;">üåø</div>
            <h2 style="color: var(--primary); margin-top: 0;">S·ªï Tay B·∫•m Huy·ªát</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">H·ªá th·ªëng l∆∞u tr·ªØ & √¥n t·∫≠p huy·ªát ƒë·∫°o th√¥ng minh</p>
            <button class="btn btn-google" id="btnLogin">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" style="margin-right:8px">
                Ti·∫øp t·ª•c v·ªõi Google
            </button>
        </div>
    </div>

    <div id="app-screen">
        <header>
            <div class="brand">üåø ƒê√¥ng Y S·ªë</div>
            <div class="user-profile">
                <img id="userAvatar" class="avatar" src="" alt="">
                <button class="btn btn-danger" style="padding: 8px 12px; font-size: 0.8rem;" id="btnLogout">Tho√°t</button>
            </div>
        </header>

        <div class="container">
            <div class="nav-pills">
                <div class="nav-item active" data-target="tab-dashboard">üìä T·ªïng Quan</div>
                <div class="nav-item" data-target="tab-quiz">üß† H·ªçc T·∫≠p</div>
                <div class="nav-item" data-target="tab-manage">‚öôÔ∏è Qu·∫£n L√Ω</div>
            </div>

            <div id="tab-dashboard" class="view active">
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="stat-streak">0</div>
                        <div class="stat-label">Ng√†y li√™n ti·∫øp</div>
                    </div>
                    <div class="stat-box" style="background: white; border: 2px solid var(--primary); color: var(--primary);">
                        <div class="stat-number" id="stat-total">0</div>
                        <div class="stat-label">Huy·ªát ƒë√£ l∆∞u</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-top:0">üìÖ L·ªãch s·ª≠ chuy√™n c·∫ßn</h3>
                    <div id="calendar" class="calendar-wrapper"></div>
                    <div style="margin-top: 15px; font-size: 0.9rem; color: #666; text-align: center;">
                        <span style="color: var(--success)">‚óè</span> ƒê√£ h·ªçc
                        <span style="color: var(--accent); margin-left: 10px;">‚ñ†</span> H√¥m nay
                    </div>
                </div>
            </div>

            <div id="tab-quiz" class="view">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin:0">√în t·∫≠p nhanh</h3>
                        <select id="quizGroupSelect" style="width: auto; margin:0; padding: 8px; font-size: 0.9rem;">
                            <option value="all">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
                        </select>
                    </div>

                    <div id="quizArea" class="quiz-container">
                        <div class="quiz-badge" id="qGroup">Nh√≥m: ...</div>
                        <div class="quiz-question" id="qQuestion">...</div>
                        <p class="quiz-desc" id="qDesc">...</p>
                        
                        <input type="text" id="qInput" placeholder="Nh·∫≠p t√™n huy·ªát..." autocomplete="off">
                        
                        <div class="feedback" id="qFeedback"></div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-secondary" id="btnShowAns">üëÅÔ∏è Xem ƒë√°p √°n</button>
                            <button class="btn btn-primary" id="btnCheckAns">‚ú® Ki·ªÉm tra</button>
                        </div>
                        <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;" id="btnNext">C√¢u ti·∫øp theo ‚ûú</button>
                    </div>
                    
                    <div id="emptyQuizMsg" style="display:none; text-align: center; padding: 30px;">
                        <div style="font-size: 3rem;">üì≠</div>
                        <p>Ch∆∞a c√≥ d·ªØ li·ªáu n√†o.</p>
                        <button class="btn btn-primary" onclick="document.querySelector('[data-target=\'tab-manage\']').click()">+ Th√™m huy·ªát ngay</button>
                    </div>
                </div>
            </div>

            <div id="tab-manage" class="view">
                <div class="card">
                    <h3 style="margin-top:0">Th√™m d·ªØ li·ªáu m·ªõi</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="inpGroup" placeholder="Nh√≥m (VD: ƒêau ƒë·∫ßu)" list="groupSuggestions">
                        <input type="text" id="inpName" placeholder="T√™n Huy·ªát">
                    </div>
                    <datalist id="groupSuggestions"></datalist>
                    <textarea id="inpDesc" rows="2" placeholder="M√¥ t·∫£ v·ªã tr√≠, t√°c d·ª•ng..."></textarea>
                    <button class="btn btn-primary" id="btnAddData" style="width: 100%">üíæ L∆∞u v√†o Cloud</button>
                </div>

                <div class="card">
                    <h3 style="margin-top:0">Danh s√°ch c·ªßa b·∫°n</h3>
                    <div id="dataList" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG FIREBASE (GI·ªÆ NGUY√äN)
        const firebaseConfig = {
            apiKey: "AIzaSyAsHD5pH6Blm4wtXKEJojFYMl24SNgiKY0",
            authDomain: "bamhuyet-6c9e6.firebaseapp.com",
            projectId: "bamhuyet-6c9e6",
            storageBucket: "bamhuyet-6c9e6.firebasestorage.app",
            messagingSenderId: "195174949274",
            appId: "1:195174949274:web:50cd99e0fad60ba8a81a23",
            measurementId: "G-W66885N5XM"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // STATE
        let currentUser = null;
        let acupoints = [];
        let currentQuizItem = null;
        let todayCheckedIn = false;

        // ELEMENTS
        const els = {
            loading: document.getElementById('loading'),
            loginScreen: document.getElementById('login-screen'),
            appScreen: document.getElementById('app-screen'),
            btnLogin: document.getElementById('btnLogin'),
            btnLogout: document.getElementById('btnLogout'),
            userAvatar: document.getElementById('userAvatar'),
            navItems: document.querySelectorAll('.nav-item'),
            views: document.querySelectorAll('.view'),
            // Manage
            inpGroup: document.getElementById('inpGroup'),
            inpName: document.getElementById('inpName'),
            inpDesc: document.getElementById('inpDesc'),
            btnAddData: document.getElementById('btnAddData'),
            dataList: document.getElementById('dataList'),
            groupSuggestions: document.getElementById('groupSuggestions'),
            // Quiz
            quizGroupSelect: document.getElementById('quizGroupSelect'),
            qGroup: document.getElementById('qGroup'),
            qQuestion: document.getElementById('qQuestion'),
            qDesc: document.getElementById('qDesc'),
            qInput: document.getElementById('qInput'),
            qFeedback: document.getElementById('qFeedback'),
            btnCheckAns: document.getElementById('btnCheckAns'),
            btnShowAns: document.getElementById('btnShowAns'),
            btnNext: document.getElementById('btnNext'),
            quizArea: document.getElementById('quizArea'),
            emptyQuizMsg: document.getElementById('emptyQuizMsg'),
            // Stats
            statStreak: document.getElementById('stat-streak'),
            statTotal: document.getElementById('stat-total'),
            calendar: document.getElementById('calendar')
        };

        // --- AUTH ---
        els.btnLogin.addEventListener('click', () => signInWithPopup(auth, provider).catch(err => showToast("L·ªói ƒëƒÉng nh·∫≠p: " + err.message)));
        els.btnLogout.addEventListener('click', () => { signOut(auth); location.reload(); });

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                els.loginScreen.style.display = 'none';
                els.appScreen.style.display = 'flex';
                els.userAvatar.src = user.photoURL;
                
                showLoading(true);
                await Promise.all([loadData(), checkAttendance()]);
                setupNavigation();
                showLoading(false);
                showToast(`Xin ch√†o, ${user.displayName.split(' ')[0]}!`);
            } else {
                els.loginScreen.style.display = 'flex';
                els.appScreen.style.display = 'none';
            }
        });

        // --- UTILS ---
        function showLoading(show) { els.loading.style.display = show ? 'flex' : 'none'; }
        
        function showToast(message) {
            const x = document.getElementById("toast");
            x.textContent = message;
            x.className = "show";
            setTimeout(() => { x.className = x.className.replace("show", ""); }, 3000);
        }

        function getTodayStr() { return new Date().toISOString().split('T')[0]; }

        // --- LOGIC D·ªÆ LI·ªÜU ---
        async function loadData() {
            try {
                const q = query(collection(db, "acupoints"), where("uid", "==", currentUser.uid));
                const snap = await getDocs(q);
                acupoints = [];
                snap.forEach((doc) => acupoints.push({ id: doc.id, ...doc.data() }));
                
                els.statTotal.textContent = acupoints.length;
                renderList();
                updateGroupSelect();
                prepareQuiz(); // Chu·∫©n b·ªã quiz nh∆∞ng ch∆∞a b·∫Øt ƒë·∫ßu t√≠nh ƒëi·ªÉm danh
            } catch (e) {
                console.error(e);
                showToast("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.");
            }
        }

        els.btnAddData.addEventListener('click', async () => {
            const group = els.inpGroup.value.trim();
            const name = els.inpName.value.trim();
            const desc = els.inpDesc.value.trim();

            if(!group || !name) return showToast("Thi·∫øu t√™n ho·∫∑c nh√≥m b·ªánh!");

            showLoading(true);
            try {
                const docRef = await addDoc(collection(db, "acupoints"), {
                    uid: currentUser.uid, group, name, desc, createdAt: serverTimestamp()
                });
                acupoints.push({ id: docRef.id, uid: currentUser.uid, group, name, desc });
                
                els.inpName.value = ''; els.inpDesc.value = '';
                els.statTotal.textContent = acupoints.length;
                renderList(); updateGroupSelect();
                showToast("ƒê√£ th√™m th√†nh c√¥ng!");
            } catch (e) { showToast("L·ªói l∆∞u d·ªØ li·ªáu."); }
            showLoading(false);
        });

        window.deleteAcupoint = async (id) => {
            if(!confirm("X√≥a huy·ªát n√†y?")) return;
            showLoading(true);
            try {
                await deleteDoc(doc(db, "acupoints", id));
                acupoints = acupoints.filter(item => item.id !== id);
                els.statTotal.textContent = acupoints.length;
                renderList(); updateGroupSelect(); prepareQuiz();
                showToast("ƒê√£ x√≥a.");
            } catch (e) { showToast("L·ªói x√≥a."); }
            showLoading(false);
        }

        // --- LOGIC ƒêI·ªÇM DANH T·ª∞ ƒê·ªòNG ---
        async function checkAttendance() {
            const today = getTodayStr();
            const q = query(collection(db, "attendance"), where("uid", "==", currentUser.uid));
            const snap = await getDocs(q);
            
            const dates = new Set();
            snap.forEach(doc => dates.add(doc.data().date));
            
            todayCheckedIn = dates.has(today);
            els.statStreak.textContent = calculateStreak(Array.from(dates));
            renderCalendar(dates);
        }

        async function tryAutoCheckIn() {
            if (todayCheckedIn) return; // ƒê√£ ƒëi·ªÉm danh r·ªìi th√¨ th√¥i
            
            try {
                const today = getTodayStr();
                await addDoc(collection(db, "attendance"), {
                    uid: currentUser.uid, date: today, timestamp: serverTimestamp()
                });
                todayCheckedIn = true;
                showToast("‚úÖ ƒê√£ t·ª± ƒë·ªông ƒëi·ªÉm danh h√¥m nay!");
                checkAttendance(); // Refresh UI
            } catch(e) { console.error("Auto checkin fail", e); }
        }

        function calculateStreak(datesArr) {
            // Logic t√≠nh streak ƒë∆°n gi·∫£n
            return datesArr.length; // T·∫°m th·ªùi hi·ªÉn th·ªã t·ªïng s·ªë ng√†y h·ªçc
        }

        // --- QUIZ LOGIC ---
        function prepareQuiz() {
            // Ch·ªâ hi·ªÉn th·ªã UI quiz n·∫øu c√≥ d·ªØ li·ªáu
            if(acupoints.length > 0) {
                els.quizArea.style.display = 'block';
                els.emptyQuizMsg.style.display = 'none';
            } else {
                els.quizArea.style.display = 'none';
                els.emptyQuizMsg.style.display = 'block';
            }
        }

        function startQuiz() {
            // ƒê√¢y l√† h√†m k√≠ch ho·∫°t c√¢u h·ªèi m·ªõi V√Ä t·ª± ƒë·ªông ƒëi·ªÉm danh
            if (acupoints.length === 0) return;

            // 1. T·ª± ƒë·ªông ƒëi·ªÉm danh v√¨ ng∆∞·ªùi d√πng ƒë√£ b·∫Øt ƒë·∫ßu h·ªçc
            tryAutoCheckIn();

            // 2. Logic Quiz
            const filter = els.quizGroupSelect.value;
            let pool = (filter === 'all') ? acupoints : acupoints.filter(i => i.group === filter);
            if (pool.length === 0) return;

            const idx = Math.floor(Math.random() * pool.length);
            currentQuizItem = pool[idx];

            els.qGroup.textContent = currentQuizItem.group;
            els.qQuestion.textContent = "Huy·ªát n√†y l√† g√¨?";
            els.qDesc.textContent = currentQuizItem.desc;
            els.qInput.value = '';
            els.qFeedback.textContent = '';
            els.qFeedback.className = 'feedback';
        }

        // Event Listeners cho Quiz
        els.quizGroupSelect.addEventListener('change', startQuiz);
        els.btnNext.addEventListener('click', startQuiz);
        
        els.btnCheckAns.addEventListener('click', () => {
            if(!currentQuizItem) { startQuiz(); return; } // N·∫øu ch∆∞a c√≥ c√¢u h·ªèi th√¨ start
            
            // K√≠ch ho·∫°t ƒëi·ªÉm danh khi t∆∞∆°ng t√°c ki·ªÉm tra (d·ª± ph√≤ng)
            tryAutoCheckIn();

            const val = els.qInput.value.trim().toLowerCase();
            if(val === currentQuizItem.name.toLowerCase()) {
                els.qFeedback.innerHTML = "üéâ Ch√≠nh x√°c!";
                els.qFeedback.className = 'feedback correct';
            } else {
                els.qFeedback.innerHTML = "‚ùå Sai r·ªìi";
                els.qFeedback.className = 'feedback wrong';
            }
        });

        els.btnShowAns.addEventListener('click', () => {
            if(!currentQuizItem) return;
            tryAutoCheckIn();
            els.qInput.value = currentQuizItem.name;
            els.qFeedback.textContent = "";
        });

        // --- UI RENDERERS ---
        function setupNavigation() {
            els.navItems.forEach(tab => {
                tab.addEventListener('click', () => {
                    els.navItems.forEach(t => t.classList.remove('active'));
                    els.views.forEach(v => v.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.add('active');

                    // N·∫øu b·∫•m v√†o tab H·ªçc t·∫≠p -> T·ª± ƒë·ªông load c√¢u h·ªèi v√† ƒëi·ªÉm danh
                    if(tab.dataset.target === 'tab-quiz') {
                        startQuiz();
                    }
                });
            });
        }

        function renderList() {
            els.dataList.innerHTML = '';
            const sorted = [...acupoints].sort((a,b) => a.group.localeCompare(b.group));
            sorted.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div>
                        <div style="font-weight:600">${item.name} <span class="item-tag">${item.group}</span></div>
                        <div style="font-size:0.85rem; color:#666; margin-top:4px">${item.desc}</div>
                    </div>
                    <button onclick="deleteAcupoint('${item.id}')" style="background:none; border:none; cursor:pointer; font-size:1.2rem; opacity:0.5">üóëÔ∏è</button>
                `;
                els.dataList.appendChild(div);
            });
        }

        function updateGroupSelect() {
            const groups = [...new Set(acupoints.map(i => i.group))];
            els.groupSuggestions.innerHTML = groups.map(g => `<option value="${g}">`).join('');
            
            const currentVal = els.quizGroupSelect.value;
            els.quizGroupSelect.innerHTML = '<option value="all">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>';
            groups.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g; opt.textContent = g;
                els.quizGroupSelect.appendChild(opt);
            });
            if(groups.includes(currentVal)) els.quizGroupSelect.value = currentVal;
        }

        function renderCalendar(checkedDates) {
            els.calendar.innerHTML = '';
            const today = new Date();
            // Render 14 ng√†y g·∫ßn nh·∫•t
            for(let i=13; i>=0; i--) {
                const d = new Date();
                d.setDate(today.getDate() - i);
                const dayStr = d.toISOString().split('T')[0];
                
                const div = document.createElement('div');
                div.className = 'cal-day';
                div.textContent = d.getDate();
                if(dayStr === getTodayStr()) div.classList.add('today');
                if(checkedDates.has(dayStr)) div.classList.add('checked');
                
                els.calendar.appendChild(div);
            }
        }
    </script>
</body>
</html>
